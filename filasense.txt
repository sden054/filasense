При печати самодельным прутком из ПЭТ бутылок (https://3deshnik.ru/forum/viewtopic.php?t=986) часто экструдер начинает проскальзывать, так как толщина прутка не постоянна. Либо застревает сварной шов. Из-за чего куча незаконченных моделей.

Взял модель с колесом-энкодером отсюда https://www.thingiverse.com/thing:4712966, переделал под свой подшипник и увеличил количество прорезей в колесе: https://www.thingiverse.com/thing:4881255

Купил TCST2103 в chipdip.ru, развел пару плат, одна под оптический датчик, вторая под attiny13a.

Набросал программку, которая работает так:

При подаче питания с платы принтера на tiny13a запускается таймер. По переполнению таймера происходит инкремент счетчика и сканирование нажатия кнопки.
Запускаем печать, нажимаем кнопку, появляется 1 на ножке, запитывающей оптический датчик (заодно зажигаем светодиод, к примеру синий). По таймеру начинает проверяться уровень с оптического датчика, если уровень сменился, тогда счетчик сбрасываем в 0.
Если счетчик достиг заданного значения, то есть состояние оптического датчика не менялось в течении 7-10 секунд, тогда останавливаем подсчет и выставляем 0 на ножке, подключенной к FIL_RUNOUT_PIN в Marlin Firmware (зажигаем светодиод Alarm) и убираем 1 с ножки, питающей оптический датчик (тушим светодиод "работа"). Marlin при включенной опции FILAMENT_RUNOUT_SENSOR и ADVANCED_PAUSE_FEATURE приостанавливает печать для смены филамента. Жмем кнопку, включается режим "работа", жмем еще раз - сенсор выключается.
После этого вручную проталкиваем филамент, если не идет - вытаскиваем, удаляя пробку. Вставляем филамент обратно. Жмем кнопку на принтере для продолжения печати. Наблюдаем за колесом энкодера, если крутится, жмем кнопку - включаем слежение.

Платы в папке pcb. Fuses в конце файла main.c

К MKS Gen_L v1.0 подключил на SERVOS1 (D11, 5V, GND).
